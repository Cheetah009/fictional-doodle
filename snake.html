<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <style>
    #box {
      width: 300px;
      height: 300px;
      border: 5px solid black;
      background-color: beige;
      margin: auto;
      position: relative;
    }
    #snake {
      width: 10px;
      height: 10px;
      background-color: cornflowerblue;
      position: absolute;
    }
    #dot {
      width: 10px;
      height: 10px;
      background-color: red;
      position: absolute;
      top: 0px;
      left: 0px;
    }
    #bodypart {
      width: 10px;
      height: 10px;
      background-color: lightskyblue;
      position: absolute;
      top: 0px;
      left: 0px;
    }
  </style>
</head>
<body>

  <div id="box">
    <div id="snake"></div>
    <div id="dot"></div>
    <div id="bodypart" hidden></div>
  </div>

  <script>
    //TODO: fix bug with direction (if you press 'left' then 'up' then 'right' within an interval gap it will change direction to opposite right away)
    const box = document.getElementById('box')
    const snake = document.getElementById('snake')
    const dot = document.getElementById('dot')
    let bodyparts = []
    bodyparts.push(document.getElementById('bodypart'))
    
    snake.style.left = box.clientWidth /2 /*- snake.clientWidth / 2 */ + 'px'
    snake.style.top = box.clientHeight /2 - snake.clientHeight + 'px'


    let speed = 300 //amount of ms between movements
    let direction = 'right';

    let timerId = setInterval(() => {
      let pastXY = [snake.style.left, snake.style.top]
      switch(direction) {
        case 'right': {
          if (parseInt(snake.style.left) >= (box.clientWidth - snake.clientWidth) ) { haltGame(); break }
          snake.style.left = parseInt(snake.style.left) + snake.clientWidth + 'px'
          break
        }
        case 'left': {
          if (parseInt(snake.style.left) <= 0 ) { haltGame(); break }
          snake.style.left = parseInt(snake.style.left) - snake.clientWidth + 'px'
          break
        }
        case 'up': {
          if (parseInt(snake.style.top) <= 0) { haltGame(); break }
          snake.style.top = parseInt(snake.style.top) - snake.clientHeight + 'px'
          break
        }
        case 'down': {
          if (parseInt(snake.style.top) >= (box.clientHeight - snake.clientHeight)) { haltGame(); break }
          snake.style.top = parseInt(snake.style.top) + snake.clientWidth + 'px'
          break
        }
      }   

      [bodyparts[0].style.left, bodyparts[0].style.top] = pastXY

      if (snake.style.left === dot.style.left && snake.style.top === dot.style.top) {
        placeDot()
        if (bodyparts[0].hidden) {
          bodyparts[0].hidden = false
          return
        }
      }
    }, speed)

    const haltGame = () => {
        clearInterval(timerId)
        alert('Проигрыш')
    }

    const dotCoords = () => {
      return [randomInteger(0, box.clientWidth / 10 - 1), 
              randomInteger(0, box.clientHeight / 10 - 1)]
    }

    const placeDot = () => {
      let [X, Y] = dotCoords()
      if (X*10 === parseInt(snake.style.left) && Y*10 === parseInt(snake.style.top)) {
        placeDot()
        return
      }
      dot.style.left = X*10 + 'px'
      dot.style.top = Y*10 + 'px'
    }

    placeDot()

    function randomInteger(min, max) {
      let rand = min + Math.random() * (max + 1 - min);
      return Math.floor(rand);
    }

    document.addEventListener('keydown', (e) => {
      let pastDirection = direction
      switch (e.code) {
        case 'ArrowRight': {
          if (pastDirection === 'left') {break}
          direction = 'right'
          break
        }
        case 'ArrowLeft': {
          if (pastDirection === 'right') {break}
          direction = 'left'
          break
        }
        case 'ArrowUp': {
          if (pastDirection === 'down') {break}
          direction = 'up'
          break
        }
        case 'ArrowDown': {
          if (pastDirection === 'up') {break}
          direction = 'down'
          break
        }
      }
    })
  </script>

</body>